apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "agent-common.fullname" . }}
  labels:
    {{- include "agent-common.labels" . | nindent 4 }}
data:
  RUN_ENV: {{ .Values.hyperlane.runEnv | quote }}
  {{- define "runDomains" -}}
  {{- range .Values.hyperlane.chains}}{{ print .name }},{{ end }}
  {{- end }}
  RUN_DOMAINS: {{ include "runDomains" . | trimSuffix "," | quote }}
  BASE_CONFIG_{{ .name | upper }}: {{ printf "%s_config.json" (.Values.hyperlane.runEnv | lower ) | quote }}
  RUST_BACKTRACE: {{ .Values.hyperlane.rustBacktrace }}
  HYP_BASE_DB: {{ .Values.hyperlane.dbPath }}
  HYP_BASE_TRACING_FMT: {{ .Values.hyperlane.tracing.format }}
  HYP_BASE_TRACING_LEVEL: {{ .Values.hyperlane.tracing.level }}
  {{- range .Values.hyperlane.chains }}
{{- include "agent-common.config-env-vars" (dict "config" . "agent_name" "base" "key_name_prefix" (printf "CHAINS_%s_" (.name | upper)) "format" "config_map") | indent 2 }}
  {{- end }}

  {{- range .Values.hyperlane.chains }}
  {{- if not .disabled }}
  HYP_BASE_CHAINS_{{ .name | upper }}_DISABLED: "false"
  HYP_BASE_CHAINS_{{ .name | upper }}_CONNECTION_TYPE: {{ .connection.type }}
  {{- if eq .connection.type "httpQuorum" }}
  HYP_BASE_CHAINS_{{ .name | upper }}_CONNECTION_URLS: ""
  {{- else }}
  HYP_BASE_CHAINS_{{ .name | upper }}_CONNECTION_URL: ""
  {{- end }}
  HYP_BASE_CHAINS_{{ .name | upper }}_NAME: {{ .name | lower }}
  {{- else}}
  HYP_BASE_CHAINS_{{ .name | upper }}_DISABLED: "true"
  {{- end }}
  {{- end }}

  {{- if .Values.hyperlane.tracing.uri }}
  HYP_BASE_TRACING_JAEGER_COLLECTOR_URI: {{ .Values.hyperlane.tracing.uri }}
  {{- end }}
  HYP_BASE_METRICS: {{ .Values.hyperlane.metrics.port | quote }}
